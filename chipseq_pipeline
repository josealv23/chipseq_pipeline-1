#! /bin/bash
echo "My chipseq pipeline" 
echo "I like coding"

#! /bin/bash

##Parámetros de entrada
PARAMS=$1


##Lectura de parámetros
WD=$(grep working_directory: $PARAMS | awk '{ print $2}')
echo $WD
MAIN_FOLDER=$(grep main_folder: $PARAMS | awk '{print $2}')
echo $MAIN_FOLDER
GEN=$(grep genome_folder: $PARAMS | awk '{print $2}')
echo $GEN
ANNO=$(grep annotation_folder: $PARAMS | awk '{print $2}')
echo $ANNO
INS=$(grep installation_folder: $PARAMS | awk '{print $2}')
echo $INS
CHIPLOC=$(grep chip_location: $PARAMS | awk '{print $2}')
echo $CHIPLOC
INPUTLOC=$(grep input_location: $PARAMS | awk '{print $2}')
echo $INPUTLOC
OUTPUT=$(grep output.file: $PARAMS | awk '{ print $2 }')
echo $OUTPUT
RES=$(grep results_folder: $PARAMS | awk '{ print $2 }')
echo $RES
NDG=$(grep ndg.file: $PARAMS | awk '{ print $2 }')
echo $NDG
OVERLAP=$(grep overlap.file: $PARAMS | awk '{ print $2 }')
echo $OVERLAP


##Construccion working directory

cd $WD

##create main folder

mkdir ${MAIN_FOLDER}
cd ${MAIN_FOLDER}

## Create subfolders
mkdir genome annotation results samples log

##Create chip e input
cd samples
mkdir chip input
cd ../genome
cp $GEN genome.fa
bowtie-build genome.fa index
cd ../annotation
cp $ANNO annotation.gtf

##Mapeo de lecturas al genoma de referencia
qsub -N chip -o chip $INS/read_mapping.sh $WD/$MAIN_FOLDER/samples/chip $CHIPLOC chip $OUTPUT $WD/$MAIN_FOLDER ${WD} $INS $NDG $OVERLAP
qsub -N input -o input $INS/read_mapping.sh $WD/$MAIN_FOLDER/samples/input $INPUTLOC input $OUTPUT $WD/$MAIN_FOLDER ${WD} $INS $NDG $OVERLAP





